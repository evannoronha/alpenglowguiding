---
import { getAllPosts } from "../lib/strapi";

const allPosts = await getAllPosts();
// Sort by date, newest first, and take the 3 most recent
const posts = allPosts
    .sort((a, b) => b.date.getTime() - a.date.getTime())
    .slice(0, 3);

const imageSize = {
        height: 230,
        width: 320
}
---

<style>
    #highlighted-posts-container {
        display: flex;
        flex-wrap: wrap;
    }
    .highlighted-post {
        flex: 1;
        margin: 10px;
    }
    .image-container {
        aspect-ratio: 7/5;
        overflow: hidden;
        object-fit: cover;
    }

    @media screen and (max-width: 700px) {
        #highlighted-posts-container {
            flex-direction: column;
        }
        .image-container {
            height: auto;
        }
    }
</style>
<div id="recent-posts">
    <h2>Recent Posts</h2>
    <div id="highlighted-posts-container">
        {
            posts.map((post) => (
                <div class="highlighted-post">
                    <div class="image-container">
                        {post.image && (
                            <img
                                src={post.image.url}
                                alt={post.image.alternativeText || post.title}
                                width={imageSize.width}
                                height={imageSize.height}
                                class="post-image"
                            />
                        )}
                    </div>
                    <a href={`/strapi-posts/${post.slug}`}>
                        <h3>{post.title}</h3>
                    </a>
                    <p>{post.description}</p>
                </div>
            ))
        }
    </div>
</div>
